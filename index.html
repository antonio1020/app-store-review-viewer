<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>App Store Review Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-body: #f4f5f7;
      --bg-card: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --primary: #ff5924;
      --primary-hover: #e64d1f;
      --border-radius: 12px;
    }

    * { box-sizing: border-box; }
    
    html {
      scrollbar-gutter: stable;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      margin: 0;
      padding: 80px 20px 40px;
      line-height: 1.5;
    }

    .container { max-width: 800px; margin: 0 auto; }

    h1 {
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 32px;
      font-weight: 400;
      letter-spacing: -0.025em;
      margin: 0 0 12px 0;
      color: #344257;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 12px;
      margin-bottom: 48px;
      background: var(--bg-card);
      padding: 8px;
      border-radius: 16px;
      border: none;
    }

    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
    }

    .input-wrapper input { width: 100%; padding-right: 40px; }

    #clearButton {
      position: absolute;
      right: 12px;
      width: auto;
      height: auto;
      background: none;
      color: #6b7280;
      border-radius: 0;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      font-weight: 500;
      user-select: none;
      line-height: 1;
    }

    #clearButton:hover { color: #374151; }
    #clearButton.show { display: flex; }

    input, select, button {
      font-size: 14px;
      border: 1px solid transparent;
      border-radius: 8px;
      outline: none;
      transition: all 0.2s;
    }

    input, select {
      background: #f9fafb;
      padding: 12px 16px;
      color: var(--text-main);
      font-weight: 500;
    }

    input:focus { background: #fff; box-shadow: 0 0 0 2px var(--primary); }

    button {
      background-color: var(--primary);
      color: white;
      font-weight: 500;
      padding: 0 24px;
      cursor: pointer;
      min-width: 140px; 
      transition: transform 0.1s ease-in-out, background-color 0.2s; 
    }

    button:hover { background-color: var(--primary-hover); }
    button:active { transform: scale(0.97); }

    .copy-btn:active {
      transform: none;
    }

    @media (max-width: 600px) {
      .controls { grid-template-columns: 1fr; padding: 16px; }
      input, select, button { height: 44px; }
      input, select { padding: 0 16px; }
      button { padding: 0 12px; min-width: 100%; }
    }

    /* Status + Copy Button Container */
    .status-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: none;
      padding-bottom: 8px;
      margin-bottom: 36px;
      width: 100%;
      flex-wrap: wrap;       /* allow wrapping to next line if needed */
      gap: 8px;              /* spacing between items */
      align-items: center;   /* vertically center items */
    }

    .status-container.has-reviews { border-bottom: 1px solid #d1d5db; }

    .status {
      font-size: 14px;
      font-weight: 600;
      color: #344257;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      flex: 1 1 auto;        /* takes remaining space */
      min-width: 0;           /* allows text to shrink */
      text-align: center;     /* center text horizontally */
    }

    .copy-btn {
      background: none;
      border: none;
      color: var(--primary);       /* primary color */
      font-weight: 600;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 14px;
      padding: 4px 8px;
      margin-left: 16px;
      border-radius: 4px;
      transition: background 0.2s;
      flex: 0 0 auto;        /* hug its content, donâ€™t grow or shrink */
      white-space: nowrap;    /* prevent text from breaking */
    }

    .copy-btn:hover { background-color: #e5e7eb; color: var(--primary); }

    .month-header {
      font-size: 14px;
      font-weight: 500;
      /* color: var(--text-muted); */
      color: #9ca3af;
      margin: 32px 0 12px 0;
      /* text-transform: uppercase; */
    }
    .month-header:first-of-type { margin-top: 10px; }

    .review {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 24px;
      margin-bottom: 16px;
      border: none;
    }
    .review-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .stars { color: #FF7F57; font-size: 18px; letter-spacing: 2px; }
    .review-date { font-size: 13px; color: #9ca3af; }
    .review-title { font-weight: 700; font-size: 16px; margin-bottom: 8px; color: #111827; }
    .review-content { color: #374151; font-size: 15px; line-height: 1.6; white-space: pre-wrap; }
    .review-footer { margin-top: 16px; padding-top: 16px; border-top: 1px solid #f3f4f6; font-size: 13px; color: #9ca3af; display: flex; gap: 12px; }
  </style>
</head>

<body>
<div class="container">
  <h1>App Store Review Viewer</h1>

  <div class="controls">
    <div class="input-wrapper">
      <input id="appInput" type="text" placeholder="Paste App Store link (e.g. apple.com/app/id12345)" autofocus />
      <span id="clearButton" title="Clear text">âœ•</span>
    </div>

    <select id="countryInput">
      <option value="us">ðŸ‡ºðŸ‡¸ USA</option>
      <option value="gb">ðŸ‡¬ðŸ‡§ UK</option>
      <option value="ca">ðŸ‡¨ðŸ‡¦ Canada</option>
      <option value="au">ðŸ‡¦ðŸ‡º Australia</option>
      <option value="de">ðŸ‡©ðŸ‡ª Germany</option>
      <option value="fr">ðŸ‡«ðŸ‡· France</option>
      <option value="it">ðŸ‡®ðŸ‡¹ Italy</option>
      <option value="jp">ðŸ‡¯ðŸ‡µ Japan</option>
      <option value="dk">ðŸ‡©ðŸ‡° Denmark</option>
    </select>

    <button id="fetchButton">Get Reviews</button>
  </div>

  <div id="status-container" class="status-container">
    <div id="status" class="status"></div>
    <button id="copyAll" class="copy-btn" style="display:none;">Copy All Reviews</button>
  </div>

  <div id="reviews"></div>
</div>

<script>
const fetchButton = document.getElementById("fetchButton");
const appInput = document.getElementById("appInput");
const clearButton = document.getElementById("clearButton");
const countryInput = document.getElementById("countryInput");
const reviewsContainer = document.getElementById("reviews");
const statusEl = document.getElementById("status");
const statusContainer = document.getElementById("status-container");
const copyAllBtn = document.getElementById("copyAll");

appInput.addEventListener("input", () => { clearButton.classList.toggle("show", appInput.value.length > 0); });
clearButton.addEventListener("click", () => { appInput.value=""; clearButton.classList.remove("show"); appInput.focus(); });

fetchButton.addEventListener("click", handleFetch);
appInput.addEventListener("keypress", e => { if(e.key==="Enter") handleFetch(); });

function extractAppId(input) {
  if(/^\d+$/.test(input)) return input;
  const match=input.match(/id(\d+)/);
  return match?match[1]:null;
}

async function fetchAllPages(appId, country) {
  let allReviews=[];
  for(let page=1;page<=5;page++){
    const url=`https://itunes.apple.com/${country}/rss/customerreviews/page=${page}/id=${appId}/sortby=mostrecent/json`;
    try{
      const response=await fetch(url);
      const data=await response.json();
      if(!data.feed||!data.feed.entry) break;
      let entries=data.feed.entry;
      if(!Array.isArray(entries)) entries=[entries];
      if(entries.length===0) break;
      allReviews.push(...entries);
    }catch(e){ console.error(e); break; }
  }

  fetchButton.disabled=false;
  fetchButton.textContent="Get Reviews";

  if(allReviews.length===0){
    statusEl.textContent="No reviews found or invalid ID.";
    statusContainer.classList.remove("has-reviews");
    copyAllBtn.style.display="none";
    return;
  }

  statusEl.textContent=`${allReviews.length} Reviews Found`;
  statusContainer.classList.add("has-reviews");
  copyAllBtn.style.display="inline-block";
  renderReviews(allReviews);
}

function handleFetch(){
  const rawInput=appInput.value.trim();
  const country=countryInput.value;
  const appId=extractAppId(rawInput);
  if(!appId){ statusEl.textContent="Please enter a valid App Store URL or ID."; statusEl.style.color="#ef4444"; return; }
  reviewsContainer.innerHTML="";
  statusEl.style.color="#344257";
  statusEl.textContent="Fetching reviews...";
  statusContainer.classList.remove("has-reviews");
  copyAllBtn.style.display="none";
  fetchButton.disabled=true;
  fetchButton.textContent="Loading...";
  fetchAllPages(appId,country);
}

function renderReviews(reviews){
  const processedReviews=reviews.map(r=>{
    const dateStr=r.updated?.label||"";
    const dateObj=dateStr?new Date(dateStr):new Date(0);
    return {...r,_dateObj:dateObj};
  });
  processedReviews.sort((a,b)=>b._dateObj-a._dateObj);

  let lastMonthYear="";
  processedReviews.forEach(r=>{
    const rating=Number(r["im:rating"]?.label||0);
    const title=r.title?.label||"";
    const content=r.content?.label||"";
    const author=r.author?.name?.label||"Unknown";
    const version=r["im:version"]?.label||"";
    const dateObj=r._dateObj;
    const displayDate=dateObj.toLocaleDateString("en-US",{year:'numeric',month:'short',day:'numeric'});
    const monthYearStr=dateObj.toLocaleDateString("en-US",{month:'long',year:'numeric'});

    if(monthYearStr!==lastMonthYear){
      const header=document.createElement("div");
      header.className="month-header";
      header.textContent=monthYearStr;
      reviewsContainer.appendChild(header);
      lastMonthYear=monthYearStr;
    }

    const div=document.createElement("div");
    div.className="review";
    div.innerHTML=`
      <div class="review-header">
        <div class="stars">${"â˜…".repeat(rating)}${"â˜†".repeat(5-rating)}</div>
        <div class="review-date">${displayDate}</div>
      </div>
      <div class="review-title">${title}</div>
      <div class="review-content">${content}</div>
      <div class="review-footer">
        <span>${author}</span>
        ${version?`<span>v${version}</span>`:""}
      </div>
    `;
    reviewsContainer.appendChild(div);
  });
}

// Copy all reviews
copyAllBtn.addEventListener("click", () => {
  const reviews = document.querySelectorAll(".review");
  if(reviews.length===0) return;

  let textToCopy="";
  reviews.forEach(r=>{
    const title=r.querySelector(".review-title")?.textContent||"";
    const content=r.querySelector(".review-content")?.textContent||"";
    textToCopy+=title+"\n"+content+"\n\n";
  });

  navigator.clipboard.writeText(textToCopy)
    .then(()=>alert("All reviews copied to clipboard!"))
    .catch(err=>console.error("Failed to copy text:",err));
});
</script>
</body>
</html>
